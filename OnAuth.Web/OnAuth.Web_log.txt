2018-04-30 15:38:03.210 +02:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [AspNetRoles] (
    [Id] nvarchar(450) NOT NULL,
    [Name] nvarchar(256) NULL,
    [NormalizedName] nvarchar(256) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY ([Id])
);
System.Data.SqlClient.SqlException (0x80131904): There is already an object named 'AspNetRoles' in the database.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite, String methodName)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.Execute(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues)
ClientConnectionId:d7d19dc8-736c-49d2-a362-e48d88e7b009
Error Number:2714,State:6,Class:16
2018-04-30 15:38:58.180 +02:00 [DBG] Using Identity.Application as default scheme for authentication
2018-04-30 15:38:58.209 +02:00 [DBG] Using Identity.External as default scheme for sign-in
2018-04-30 15:38:58.209 +02:00 [DBG] Using Identity.External as default scheme for sign-out
2018-04-30 15:38:58.209 +02:00 [DBG] Using Identity.Application as default scheme for challenge
2018-04-30 15:38:58.209 +02:00 [DBG] Using Identity.Application as default scheme for forbid
2018-04-30 15:38:58.360 +02:00 [DBG] Starting token cleanup
2018-04-30 15:48:23.927 +02:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [AspNetRoles] (
    [Id] nvarchar(450) NOT NULL,
    [Name] nvarchar(256) NULL,
    [NormalizedName] nvarchar(256) NULL,
    [ConcurrencyStamp] nvarchar(max) NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY ([Id])
);
System.Data.SqlClient.SqlException (0x80131904): There is already an object named 'AspNetRoles' in the database.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.SqlCommand.RunExecuteNonQueryTds(String methodName, Boolean async, Int32 timeout, Boolean asyncWrite)
   at System.Data.SqlClient.SqlCommand.InternalExecuteNonQuery(TaskCompletionSource`1 completion, Boolean sendToPipe, Int32 timeout, Boolean asyncWrite, String methodName)
   at System.Data.SqlClient.SqlCommand.ExecuteNonQuery()
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.Execute(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues)
ClientConnectionId:62ae65fe-77fa-43fe-8d34-c7a9ee028a24
Error Number:2714,State:6,Class:16
2018-04-30 15:49:20.278 +02:00 [DBG] Using Identity.Application as default scheme for authentication
2018-04-30 15:49:20.301 +02:00 [DBG] Using Identity.External as default scheme for sign-in
2018-04-30 15:49:20.302 +02:00 [DBG] Using Identity.External as default scheme for sign-out
2018-04-30 15:49:20.302 +02:00 [DBG] Using Identity.Application as default scheme for challenge
2018-04-30 15:49:20.302 +02:00 [DBG] Using Identity.Application as default scheme for forbid
2018-04-30 15:49:20.386 +02:00 [DBG] Starting token cleanup
2018-04-30 15:49:52.894 +02:00 [INF] AuthenticationScheme: Identity.Application was challenged.
2018-04-30 15:49:57.046 +02:00 [ERR] Failed executing DbCommand (13ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
FROM [AspNetUsers] AS [u]
WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
System.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:005c4685-9407-4139-a96d-3c7b9e94b437
Error Number:208,State:1,Class:16
2018-04-30 15:49:57.161 +02:00 [ERR] An exception occurred in the database while iterating the results of a query for context type 'OnAuth.Web.Data.ApplicationDbContext'.
System.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.BufferlessMoveNext(DbContext _, Boolean buffer, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.FirstOrDefault_[TSource](IAsyncEnumerable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.TaskResultAsyncEnumerable`1.Enumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.SelectEnumerableAsyncIterator`2.MoveNextCore(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.AsyncIterator`1.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext(CancellationToken cancellationToken)
ClientConnectionId:005c4685-9407-4139-a96d-3c7b9e94b437
Error Number:208,State:1,Class:16
System.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.BufferlessMoveNext(DbContext _, Boolean buffer, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.FirstOrDefault_[TSource](IAsyncEnumerable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.TaskResultAsyncEnumerable`1.Enumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.SelectEnumerableAsyncIterator`2.MoveNextCore(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.AsyncIterator`1.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext(CancellationToken cancellationToken)
ClientConnectionId:005c4685-9407-4139-a96d-3c7b9e94b437
Error Number:208,State:1,Class:16
2018-04-30 15:49:57.271 +02:00 [ERR] An exception occurred in the database while iterating the results of a query for context type 'OnAuth.Web.Data.ApplicationDbContext'.
System.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.BufferlessMoveNext(DbContext _, Boolean buffer, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.FirstOrDefault_[TSource](IAsyncEnumerable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.TaskResultAsyncEnumerable`1.Enumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.SelectEnumerableAsyncIterator`2.MoveNextCore(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.AsyncIterator`1.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteSingletonAsyncQuery[TResult](QueryContext queryContext, Func`2 compiledQuery, IDiagnosticsLogger`1 logger, Type contextType)
ClientConnectionId:005c4685-9407-4139-a96d-3c7b9e94b437
Error Number:208,State:1,Class:16
System.Data.SqlClient.SqlException (0x80131904): Invalid object name 'AspNetUsers'.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.BufferlessMoveNext(DbContext _, Boolean buffer, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncQueryingEnumerable`1.AsyncEnumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.FirstOrDefault_[TSource](IAsyncEnumerable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.TaskResultAsyncEnumerable`1.Enumerator.MoveNext(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.SelectEnumerableAsyncIterator`2.MoveNextCore(CancellationToken cancellationToken)
   at System.Linq.AsyncEnumerable.AsyncIterator`1.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.AsyncLinqOperatorProvider.ExceptionInterceptor`1.EnumeratorExceptionInterceptor.MoveNext(CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteSingletonAsyncQuery[TResult](QueryContext queryContext, Func`2 compiledQuery, IDiagnosticsLogger`1 logger, Type contextType)
ClientConnectionId:005c4685-9407-4139-a96d-3c7b9e94b437
Error Number:208,State:1,Class:16
2018-04-30 15:50:47.637 +02:00 [DBG] Using Identity.Application as default scheme for authentication
2018-04-30 15:50:47.662 +02:00 [DBG] Using Identity.External as default scheme for sign-in
2018-04-30 15:50:47.663 +02:00 [DBG] Using Identity.External as default scheme for sign-out
2018-04-30 15:50:47.663 +02:00 [DBG] Using Identity.Application as default scheme for challenge
2018-04-30 15:50:47.663 +02:00 [DBG] Using Identity.Application as default scheme for forbid
2018-04-30 15:50:47.761 +02:00 [DBG] Starting token cleanup
2018-04-30 15:50:56.706 +02:00 [INF] AuthenticationScheme: Identity.Application was challenged.
2018-04-30 15:51:01.704 +02:00 [DBG] Augmenting SignInContext
2018-04-30 15:51:01.706 +02:00 [DBG] Adding idp claim with value: local
2018-04-30 15:51:01.706 +02:00 [DBG] Adding amr claim with value: pwd
2018-04-30 15:51:01.707 +02:00 [DBG] Adding auth_time claim with value: 1525096261
2018-04-30 15:51:01.717 +02:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-04-30 15:51:01.756 +02:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "alice",
  "SubjectId": "6a960371-2f72-4db1-bcb8-01294b612220",
  "DisplayName": "alice",
  "Endpoint": "UI",
  "ActivityId": "0HLDEK5GD7UPB:00000004",
  "TimeStamp": "2018-04-30T13:51:01Z",
  "ProcessId": 437416,
  "LocalIpAddress": "127.0.0.1:21537",
  "RemoteIpAddress": "::1"
}
2018-04-30 15:51:01.818 +02:00 [DBG] 0 persisted grants found for 6a960371-2f72-4db1-bcb8-01294b612220
2018-04-30 15:51:11.679 +02:00 [INF] AuthenticationScheme: Identity.Application was challenged.
2018-04-30 15:51:15.901 +02:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-04-30 15:51:15.916 +02:00 [DBG] Augmenting SignInContext
2018-04-30 15:51:15.916 +02:00 [DBG] Adding idp claim with value: local
2018-04-30 15:51:15.916 +02:00 [DBG] Adding amr claim with value: pwd
2018-04-30 15:51:15.916 +02:00 [DBG] Adding auth_time claim with value: 1525096275
2018-04-30 15:51:15.916 +02:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-04-30 15:51:15.917 +02:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "alice",
  "SubjectId": "6a960371-2f72-4db1-bcb8-01294b612220",
  "DisplayName": "alice",
  "Endpoint": "UI",
  "ActivityId": "0HLDEK5GD7UPB:0000000A",
  "TimeStamp": "2018-04-30T13:51:15Z",
  "ProcessId": 437416,
  "LocalIpAddress": "127.0.0.1:21537",
  "RemoteIpAddress": "::1"
}
2018-04-30 15:51:15.927 +02:00 [DBG] 0 persisted grants found for 6a960371-2f72-4db1-bcb8-01294b612220
2018-04-30 15:51:39.577 +02:00 [DBG] Stopping token cleanup
2018-04-30 15:51:39.579 +02:00 [DBG] TaskCanceledException. Exiting.
2018-04-30 15:51:59.159 +02:00 [DBG] Using Identity.Application as default scheme for authentication
2018-04-30 15:51:59.188 +02:00 [DBG] Using Identity.External as default scheme for sign-in
2018-04-30 15:51:59.189 +02:00 [DBG] Using Identity.External as default scheme for sign-out
2018-04-30 15:51:59.189 +02:00 [DBG] Using Identity.Application as default scheme for challenge
2018-04-30 15:51:59.189 +02:00 [DBG] Using Identity.Application as default scheme for forbid
2018-04-30 15:51:59.284 +02:00 [DBG] Starting token cleanup
2018-04-30 15:51:59.451 +02:00 [DBG] Request path /.well-known/openid-configuration matched to endpoint type Discovery
2018-04-30 15:51:59.466 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryEndpoint
2018-04-30 15:51:59.467 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryEndpoint for /.well-known/openid-configuration
2018-04-30 15:51:59.470 +02:00 [DBG] Start discovery request
2018-04-30 15:51:59.862 +02:00 [DBG] Request path /.well-known/openid-configuration/jwks matched to endpoint type Discovery
2018-04-30 15:51:59.864 +02:00 [DBG] Endpoint enabled: Discovery, successfully created handler: IdentityServer4.Endpoints.DiscoveryKeyEndpoint
2018-04-30 15:51:59.864 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.DiscoveryKeyEndpoint for /.well-known/openid-configuration/jwks
2018-04-30 15:51:59.867 +02:00 [DBG] Start key discovery request
2018-04-30 15:51:59.998 +02:00 [DBG] Request path /connect/authorize matched to endpoint type Authorize
2018-04-30 15:52:00.004 +02:00 [DBG] Endpoint enabled: Authorize, successfully created handler: IdentityServer4.Endpoints.AuthorizeEndpoint
2018-04-30 15:52:00.004 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.AuthorizeEndpoint for /connect/authorize
2018-04-30 15:52:00.008 +02:00 [DBG] Start authorize request
2018-04-30 15:52:00.022 +02:00 [DBG] User in authorize request: 6a960371-2f72-4db1-bcb8-01294b612220
2018-04-30 15:52:00.027 +02:00 [DBG] Start authorize request protocol validation
2018-04-30 15:52:00.043 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:00.050 +02:00 [DBG] Checking for PKCE parameters
2018-04-30 15:52:00.052 +02:00 [DBG] No PKCE used.
2018-04-30 15:52:00.098 +02:00 [DBG] Calling into custom validator: IdentityServer4.Validation.DefaultCustomAuthorizeRequestValidator
2018-04-30 15:52:00.112 +02:00 [INF] ValidatedAuthorizeRequest
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "https://localhost:44300/signin-oidc",
  "AllowedRedirectUris": [
    "https://localhost:44300/signin-oidc"
  ],
  "SubjectId": "6a960371-2f72-4db1-bcb8-01294b612220",
  "ResponseType": "code id_token",
  "ResponseMode": "form_post",
  "GrantType": "hybrid",
  "RequestedScopes": "openid profile api1 offline_access",
  "State": "CfDJ8BMQ0_Vk4dtBt31gDXy7xh_qMYGkzo44IAkyj3Zv51RI1BWk9rXYSbQXb2h24US4Ifq2d9TX5SmDc9--FYqb94e9lHHvAKCq4f78rf4x79bhWxMLQnlhOpWDE0YaquVSTiKHJA6nWhmTFW5jA24jiXECIhpGRq39udHwls_0GkmoTWT4NDFnCNaJiFEhidtp_LTnDl6gwtL65BAFhOyRTB-b0ib-qraH8ZGa9ZGccaTdOKeAbQRBRgYi_B2NJ31ImmGa8_DutgWN4upxEtavErqRl_J1WWKzIhcBwAdq8rOZwPnlsugk_2szoKMWqIFSbg4hhqbq9cCf8DCyssxOp8w",
  "Nonce": "636606931199184672.NTVmYmRjNGYtOWZhNS00OTllLThiM2UtYjQzZTRjOTRjZjAzMGM4ODBiM2QtYjI4OS00YmZkLWI1YTYtMTI2NjE4NzNkMDRm",
  "SessionId": "0905769b23720be3273e81d46e67a70c",
  "Raw": {
    "client_id": "mvc",
    "redirect_uri": "https://localhost:44300/signin-oidc",
    "response_type": "code id_token",
    "scope": "openid profile api1 offline_access",
    "response_mode": "form_post",
    "nonce": "636606931199184672.NTVmYmRjNGYtOWZhNS00OTllLThiM2UtYjQzZTRjOTRjZjAzMGM4ODBiM2QtYjI4OS00YmZkLWI1YTYtMTI2NjE4NzNkMDRm",
    "state": "CfDJ8BMQ0_Vk4dtBt31gDXy7xh_qMYGkzo44IAkyj3Zv51RI1BWk9rXYSbQXb2h24US4Ifq2d9TX5SmDc9--FYqb94e9lHHvAKCq4f78rf4x79bhWxMLQnlhOpWDE0YaquVSTiKHJA6nWhmTFW5jA24jiXECIhpGRq39udHwls_0GkmoTWT4NDFnCNaJiFEhidtp_LTnDl6gwtL65BAFhOyRTB-b0ib-qraH8ZGa9ZGccaTdOKeAbQRBRgYi_B2NJ31ImmGa8_DutgWN4upxEtavErqRl_J1WWKzIhcBwAdq8rOZwPnlsugk_2szoKMWqIFSbg4hhqbq9cCf8DCyssxOp8w",
    "x-client-SKU": "ID_NET451",
    "x-client-ver": "5.2.0.0"
  }
}
2018-04-30 15:52:00.689 +02:00 [DBG] Client is configured to not require consent, no consent is required
2018-04-30 15:52:00.700 +02:00 [DBG] Creating Hybrid Flow response.
2018-04-30 15:52:00.828 +02:00 [DBG] +SkITe06pRGpScvhbCysWRvcMDjD4vRkGkY4oGJuXHs= not found in database
2018-04-30 15:52:01.157 +02:00 [DBG] Creating Implicit Flow response.
2018-04-30 15:52:01.168 +02:00 [DBG] Getting claims for identity token for subject: 6a960371-2f72-4db1-bcb8-01294b612220 and client: mvc
2018-04-30 15:52:01.170 +02:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-04-30 15:52:01.265 +02:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "RedirectUri": "https://localhost:44300/signin-oidc",
  "Endpoint": "Authorize",
  "SubjectId": "6a960371-2f72-4db1-bcb8-01294b612220",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "hybrid",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****gk2A"
    },
    {
      "TokenType": "code",
      "TokenValue": "****e22f"
    }
  ],
  "ActivityId": "0HLDEK65L618R:00000003",
  "TimeStamp": "2018-04-30T13:52:01Z",
  "ProcessId": 479224,
  "LocalIpAddress": "127.0.0.1:9599",
  "RemoteIpAddress": "::1"
}
2018-04-30 15:52:01.273 +02:00 [INF] Authorize endpoint response
{
  "SubjectId": "6a960371-2f72-4db1-bcb8-01294b612220",
  "ClientId": "mvc",
  "RedirectUri": "https://localhost:44300/signin-oidc",
  "State": "CfDJ8BMQ0_Vk4dtBt31gDXy7xh_qMYGkzo44IAkyj3Zv51RI1BWk9rXYSbQXb2h24US4Ifq2d9TX5SmDc9--FYqb94e9lHHvAKCq4f78rf4x79bhWxMLQnlhOpWDE0YaquVSTiKHJA6nWhmTFW5jA24jiXECIhpGRq39udHwls_0GkmoTWT4NDFnCNaJiFEhidtp_LTnDl6gwtL65BAFhOyRTB-b0ib-qraH8ZGa9ZGccaTdOKeAbQRBRgYi_B2NJ31ImmGa8_DutgWN4upxEtavErqRl_J1WWKzIhcBwAdq8rOZwPnlsugk_2szoKMWqIFSbg4hhqbq9cCf8DCyssxOp8w",
  "Scope": "openid profile api1 offline_access"
}
2018-04-30 15:52:01.311 +02:00 [DBG] Augmenting SignInContext
2018-04-30 15:52:01.323 +02:00 [INF] AuthenticationScheme: Identity.Application signed in.
2018-04-30 15:52:02.101 +02:00 [DBG] Request path /connect/token matched to endpoint type Token
2018-04-30 15:52:02.105 +02:00 [DBG] Endpoint enabled: Token, successfully created handler: IdentityServer4.Endpoints.TokenEndpoint
2018-04-30 15:52:02.105 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.TokenEndpoint for /connect/token
2018-04-30 15:52:02.113 +02:00 [DBG] Start token request.
2018-04-30 15:52:02.119 +02:00 [DBG] Start client validation
2018-04-30 15:52:02.124 +02:00 [DBG] Start parsing Basic Authentication secret
2018-04-30 15:52:02.128 +02:00 [DBG] Start parsing for secret in post body
2018-04-30 15:52:02.144 +02:00 [DBG] Parser found secret: PostBodySecretParser
2018-04-30 15:52:02.144 +02:00 [DBG] Secret id found: mvc
2018-04-30 15:52:02.145 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:02.154 +02:00 [DBG] Secret validator success: HashedSharedSecretValidator
2018-04-30 15:52:02.154 +02:00 [DBG] Client validation success
2018-04-30 15:52:02.159 +02:00 [INF] {
  "Name": "Client Authentication Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1010,
  "ClientId": "mvc",
  "AuthenticationMethod": "SharedSecret",
  "ActivityId": "0HLDEK65L618R:00000004",
  "TimeStamp": "2018-04-30T13:52:02Z",
  "ProcessId": 479224,
  "LocalIpAddress": "127.0.0.1:9599",
  "RemoteIpAddress": "::1"
}
2018-04-30 15:52:02.166 +02:00 [DBG] Start token request validation
2018-04-30 15:52:02.177 +02:00 [DBG] Start validation of authorization code token request
2018-04-30 15:52:02.222 +02:00 [DBG] +SkITe06pRGpScvhbCysWRvcMDjD4vRkGkY4oGJuXHs= found in database: true
2018-04-30 15:52:02.248 +02:00 [DBG] removing +SkITe06pRGpScvhbCysWRvcMDjD4vRkGkY4oGJuXHs= persisted grant from database
2018-04-30 15:52:02.258 +02:00 [DBG] Validation of authorization code token request success
2018-04-30 15:52:02.264 +02:00 [INF] Token request validation success
{
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "GrantType": "authorization_code",
  "AuthorizationCode": "30d5949d40562ce6cb4d846a1b094f4e85043b737cf33258ed6a6ae39009e22f",
  "Raw": {
    "client_id": "mvc",
    "client_secret": "***REDACTED***",
    "code": "30d5949d40562ce6cb4d846a1b094f4e85043b737cf33258ed6a6ae39009e22f",
    "grant_type": "authorization_code",
    "redirect_uri": "https://localhost:44300/signin-oidc"
  }
}
2018-04-30 15:52:02.281 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:02.292 +02:00 [DBG] Getting claims for access token for client: mvc
2018-04-30 15:52:02.293 +02:00 [DBG] Getting claims for access token for subject: 6a960371-2f72-4db1-bcb8-01294b612220
2018-04-30 15:52:02.397 +02:00 [DBG] Creating refresh token
2018-04-30 15:52:02.397 +02:00 [DBG] Setting an absolute lifetime: 2592000
2018-04-30 15:52:02.413 +02:00 [DBG] Y+qhOdTPseZN2nZsBjV/oEcUp5rX5BffXv4SexQ1VmY= not found in database
2018-04-30 15:52:02.418 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:02.419 +02:00 [DBG] Getting claims for identity token for subject: 6a960371-2f72-4db1-bcb8-01294b612220 and client: mvc
2018-04-30 15:52:02.419 +02:00 [DBG] In addition to an id_token, an access_token was requested. No claims other than sub are included in the id_token. To obtain more user claims, either use the user info endpoint or set AlwaysIncludeUserClaimsInIdToken on the client configuration.
2018-04-30 15:52:02.426 +02:00 [INF] {
  "Name": "Token Issued Success",
  "Category": "Token",
  "EventType": "Success",
  "Id": 2000,
  "ClientId": "mvc",
  "ClientName": "MVC Client",
  "Endpoint": "Token",
  "Scopes": "openid profile api1 offline_access",
  "GrantType": "authorization_code",
  "Tokens": [
    {
      "TokenType": "id_token",
      "TokenValue": "****PYUQ"
    },
    {
      "TokenType": "refresh_token",
      "TokenValue": "****a834"
    },
    {
      "TokenType": "access_token",
      "TokenValue": "****AYOA"
    }
  ],
  "ActivityId": "0HLDEK65L618R:00000004",
  "TimeStamp": "2018-04-30T13:52:02Z",
  "ProcessId": 479224,
  "LocalIpAddress": "127.0.0.1:9599",
  "RemoteIpAddress": "::1"
}
2018-04-30 15:52:02.427 +02:00 [DBG] Token request success.
2018-04-30 15:52:02.457 +02:00 [DBG] Request path /connect/userinfo matched to endpoint type Userinfo
2018-04-30 15:52:02.459 +02:00 [DBG] Endpoint enabled: Userinfo, successfully created handler: IdentityServer4.Endpoints.UserInfoEndpoint
2018-04-30 15:52:02.459 +02:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Endpoints.UserInfoEndpoint for /connect/userinfo
2018-04-30 15:52:02.466 +02:00 [DBG] Start userinfo request
2018-04-30 15:52:02.470 +02:00 [DBG] Bearer token found in header
2018-04-30 15:52:02.547 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:02.550 +02:00 [DBG] client configuration validation for client mvc succeeded.
2018-04-30 15:52:02.556 +02:00 [DBG] Calling into custom token validator: IdentityServer4.Validation.DefaultCustomTokenValidator
2018-04-30 15:52:02.561 +02:00 [DBG] Token validation success
{
  "ValidateLifetime": true,
  "AccessTokenType": "Jwt",
  "ExpectedScope": "openid",
  "Claims": {
    "nbf": 1525096322,
    "exp": 1525099922,
    "iss": "http://localhost:5000",
    "aud": [
      "http://localhost:5000/resources",
      "api1"
    ],
    "client_id": "mvc",
    "sub": "6a960371-2f72-4db1-bcb8-01294b612220",
    "auth_time": 1525096275,
    "idp": "local",
    "scope": [
      "openid",
      "profile",
      "api1",
      "offline_access"
    ],
    "amr": "pwd"
  }
}
2018-04-30 15:52:02.573 +02:00 [DBG] Creating userinfo response
2018-04-30 15:52:02.577 +02:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-04-30 15:52:02.580 +02:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-04-30 15:52:02.583 +02:00 [DBG] Requested claim types: sub name family_name given_name middle_name nickname preferred_username profile picture website gender birthdate zoneinfo locale updated_at
2018-04-30 15:52:02.583 +02:00 [DBG] Scopes in access token: openid profile api1 offline_access
2018-04-30 15:52:02.588 +02:00 [INF] Profile service returned to the following claim types: sub name given_name family_name website preferred_username
2018-04-30 15:52:02.588 +02:00 [DBG] End userinfo request
